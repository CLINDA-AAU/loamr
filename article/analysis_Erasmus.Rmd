---
title: "Analysis of data from Erasmus et al. (2003)"
author: "Lars Nielsen and Heidi S. Christensen"
date: "10/01/2020"
output:
  html_document:
    code_folding: hide
    theme: flatly
    toc: yes
    toc_float:
      collapsed: no
---

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(loamr)
library(knitr)
library(kableExtra)
#devtools::install_github("thomasp85/patchwork")
library(patchwork)
```

# Data
Here we consider measurements on lung tumours from a study described in Erasmus et al (2003). The data is in wide format, but is transformed into long format (as this is what the 'LOAM' function uses):

```{r}
data(Erasmus)
head(Erasmus)

Erasmus <- Erasmus %>%
  mutate(subject = 1:nrow(.)) %>%
  gather(observer, value, -subject) %>% 
  mutate(observer = as.numeric(str_extract(observer, pattern = "[:digit:]+")))
```

# Analysis of agreement

Calculation of estimate and confidence intervals for the limits of agreement with the mean (LOAM):

```{r}
LOAM(Erasmus)
```

Agreement plots (with symmetric and asymmetric confidence intervals for the LOAM):
```{r fig.height=4, fig.width=9}
p1 <- plot(LOAM(Erasmus), CI = "sym")  + scale_y_continuous(limits = c(-3,2)) + labs(title = NULL, subtitle = NULL, tag = "A") +
      plot(LOAM(Erasmus), CI = "asym") + scale_y_continuous(limits = c(-3,2)) + labs(title = NULL, subtitle = NULL, tag = "B") + 
      patchwork::plot_layout(guides = "collect")
p1

ggsave(p1,  filename = "plots/p1.jpg",  dpi = 600, height = 4, width = 9)

```

